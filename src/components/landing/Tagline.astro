---
import { getLangFromUrl, useTranslations } from "@i18n/utils";

const { class: className } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<div id="smooth-wrapper" class:list={["section tagline-section relative bg-zinc-900 text-white", className]}>
  <div class="tagline-arrows">
    <svg 
      viewBox="0 0 550 330" 
      class="h-[25rem] w-[25rem] md:w-[30rem]"
    >
      <!-- Line (path) -->
      <path
        id="tagline-path"
        fill="none"
        stroke="white"
        stroke-width="12"
        opacity="0"
        d="M8.5,7.8C46.3,67,121.7,185.5,265.5,185.9c42.8,0.1,120.5-55.9-25.2-120.3C79-5.8,177.6,164.1,222.3,207.7c59.1,49.9,83.8,62.1,162.6,96.8"
      ></path>
      
      <!-- Triangle -->
      <path
        id="tagline-arrow"
        stroke="white"
        fill="white"
        opacity="0"
        d="M465.7 172.9l47.1 6-29.8 33.3-17.3-39.3z"
      ></path>
    </svg>
  </div>

  <div class="text col-span-12 flex justify-center font-light">
    <p id="tagline-text" class="max-w-5xl text-center text-4xl md:text-5xl lg:text-7xl">
      <span class="gradient-text">{t("tagline")}</span>
    </p>
  </div>
</div>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";
  import { MotionPathPlugin } from "gsap/MotionPathPlugin";

  gsap.registerPlugin(ScrollTrigger, MotionPathPlugin);

  // SIMPLE SCROLL-BASED ANIMATION
  document.addEventListener("DOMContentLoaded", () => {
    const line = document.querySelector("#tagline-path");
    const arrow = document.querySelector("#tagline-arrow");

    // Reset initial state
    gsap.set([line, arrow], { opacity: 0 });
    gsap.set(line, { drawSVG: "0%" });

    // Single timeline for all animations
    const tl = gsap.timeline({
      scrollTrigger: {
        trigger: ".tagline-arrows",
        start: "top 80%",
        end: "bottom 20%",
        scrub: 1,
      }
    });

    // Line draws + fades in
    tl.to(line, {
      drawSVG: "100%",
      opacity: 1,
      duration: 2
    });

    // Arrow follows path + fades in
    tl.to(arrow, {
      opacity: 1,
      motionPath: {
        path: "#tagline-path",
        align: "path",
        autoRotate: 90,
      },
    }, "<"); // Start with line animation
  });
</script>
